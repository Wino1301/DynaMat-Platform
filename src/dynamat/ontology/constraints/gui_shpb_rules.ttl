@prefix gui: <https://dynamat.utep.edu/gui/constraints#> .
@prefix dyn: <https://dynamat.utep.edu/ontology#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dc: <http://purl.org/dc/elements/1.1/> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

#################################################################
# SHPB COMPRESSION TEST FORM CONSTRAINTS (Unified Format)
#################################################################

#================================================================
# 1.0 Momentum Trap Configuration
#================================================================

gui:shpb_c001 a gui:Constraint ;
    rdfs:label "Show momentum trap distance for tailored gap configuration" ;
    rdfs:comment "Displays momentum trap tailored distance field only when momentum trap is set to TailoredGap configuration. Hides the field for Full momentum trap or when no momentum trap is selected." ;
    dc:created "2025-02-01"^^xsd:date ;
    gui:forClass dyn:SHPBCompression ;
    gui:triggers dyn:hasMomentumTrap ;
    gui:triggerLogic gui:ALL ;
    gui:whenValue dyn:MomentumTrap_TailoredGap ;
    gui:showFields (dyn:hasMomentumTrapTailoredDistance) ;
    gui:priority 1 .

#================================================================
# 2.0 Bar Material Property Population
# Note: Only striker bar shows material properties. Incident and transmission
# bars are expected to use the same material (enforced by SHACL shapes later).
#================================================================

gui:shpb_c002 a gui:Constraint ;
    rdfs:label "Bar Material Properties" ;
    rdfs:comment "When striker bar is selected, displays bar material properties (material name, wave speed, elastic modulus, density) in a read-only PropertyDisplayWidget. All three bars (striker, incident, transmission) are expected to use the same material." ;
    dc:created "2025-02-03"^^xsd:date ;
    gui:forClass dyn:SHPBCompression ;
    gui:triggers dyn:hasStrikerBar ;
    gui:triggerLogic gui:ALL ;
    gui:whenValue gui:anyValue ;
    gui:populateFields (
        (dyn:hasMaterial "Material")
        (dyn:hasWaveSpeed "Wave Speed")
        (dyn:hasElasticModulus "Elastic Modulus")
        (dyn:hasDensity "Density")
    ) ;
    gui:makeReadOnly true ;
    gui:targetWidget "BarMaterialProperties" ;
    gui:priority 10 .

#================================================================
# 3.0 Strain Gauge Property Population
#================================================================

gui:shpb_c005 a gui:Constraint ;
    rdfs:label "Incident SG Properties" ;
    rdfs:comment "When incident strain gauge is selected, displays gauge properties (gauge factor, resistance, calibration values, distance from specimen) in a read-only PropertyDisplayWidget." ;
    dc:created "2025-02-03"^^xsd:date ;
    gui:forClass dyn:SHPBCompression ;
    gui:triggers dyn:hasIncidentStrainGauge ;
    gui:triggerLogic gui:ALL ;
    gui:whenValue gui:anyValue ;
    gui:populateFields (
        (dyn:hasGaugeFactor "Gauge Factor")
        (dyn:hasGaugeResistance "Gauge Resistance")
        (dyn:hasCalibrationVoltage "Calibration Voltage")
        (dyn:hasCalibrationResistance "Calibration Resistance")
        (dyn:hasDistanceFromSpecimen "Distance from Specimen")
    ) ;
    gui:makeReadOnly true ;
    gui:targetWidget "IncidentStrainGaugeProperties" ;
    gui:priority 10 .

gui:shpb_c006 a gui:Constraint ;
    rdfs:label "Transmitted SG Properties" ;
    rdfs:comment "When transmission strain gauge is selected, displays gauge properties (gauge factor, resistance, calibration values, distance from specimen) in a read-only PropertyDisplayWidget." ;
    dc:created "2025-02-03"^^xsd:date ;
    gui:forClass dyn:SHPBCompression ;
    gui:triggers dyn:hasTransmissionStrainGauge ;
    gui:triggerLogic gui:ALL ;
    gui:whenValue gui:anyValue ;
    gui:populateFields (
        (dyn:hasGaugeFactor "Gauge Factor")
        (dyn:hasGaugeResistance "Gauge Resistance")
        (dyn:hasCalibrationVoltage "Calibration Voltage")
        (dyn:hasCalibrationResistance "Calibration Resistance")
        (dyn:hasDistanceFromSpecimen "Distance from Specimen")
    ) ;
    gui:makeReadOnly true ;
    gui:targetWidget "TransmissionStrainGaugeProperties" ;
    gui:priority 10 .

#================================================================
# 4.0 Pulse Characteristics (Calculated from Equipment)
# Six ontology-driven calculation constraints that resolve inputs
# from nested individual properties (bar → length, bar → material → wave speed)
# and compute theoretical pulse characteristics.
#================================================================

gui:shpb_calc_001 a gui:Constraint ;
    rdfs:label "Pulse Duration Calculation" ;
    rdfs:comment "Compute pulse duration T = 2L/C from striker length and bar wave speed." ;
    dc:created "2025-02-12"^^xsd:date ;
    gui:forClass dyn:SHPBCompression ;
    gui:triggers dyn:hasStrikerVelocity ;
    gui:whenValue gui:anyValue ;
    gui:calculationFunction "pulse_duration" ;
    gui:calculationTarget dyn:hasPulseDuration ;
    gui:calculationInputs (
        (dyn:hasStrikerBar dyn:hasLength "striker_length")
        (dyn:hasIncidentBar dyn:hasMaterial dyn:hasWaveSpeed "bar_wave_speed")
    ) ;
    gui:priority 8 .

gui:shpb_calc_002 a gui:Constraint ;
    rdfs:label "Pulse Length Calculation" ;
    rdfs:comment "Compute pulse spatial length = 2L from striker length." ;
    dc:created "2025-02-12"^^xsd:date ;
    gui:forClass dyn:SHPBCompression ;
    gui:triggers dyn:hasStrikerVelocity ;
    gui:whenValue gui:anyValue ;
    gui:calculationFunction "pulse_length" ;
    gui:calculationTarget dyn:hasPulseLength ;
    gui:calculationInputs (
        (dyn:hasStrikerBar dyn:hasLength "striker_length")
    ) ;
    gui:priority 8 .

gui:shpb_calc_003 a gui:Constraint ;
    rdfs:label "Pulse Speed Calculation" ;
    rdfs:comment "Pulse speed equals bar wave speed C." ;
    dc:created "2025-02-12"^^xsd:date ;
    gui:forClass dyn:SHPBCompression ;
    gui:triggers dyn:hasStrikerVelocity ;
    gui:whenValue gui:anyValue ;
    gui:calculationFunction "pulse_speed" ;
    gui:calculationTarget dyn:hasPulseSpeed ;
    gui:calculationInputs (
        (dyn:hasIncidentBar dyn:hasMaterial dyn:hasWaveSpeed "bar_wave_speed")
    ) ;
    gui:priority 8 .

gui:shpb_calc_004 a gui:Constraint ;
    rdfs:label "Pulse Strain Amplitude Calculation" ;
    rdfs:comment "Compute strain amplitude = V / (2C) from striker velocity and bar wave speed." ;
    dc:created "2025-02-12"^^xsd:date ;
    gui:forClass dyn:SHPBCompression ;
    gui:triggers dyn:hasStrikerVelocity ;
    gui:whenValue gui:anyValue ;
    gui:calculationFunction "pulse_strain_amplitude" ;
    gui:calculationTarget dyn:hasPulseStrainAmplitude ;
    gui:calculationInputs (
        (dyn:hasIncidentBar dyn:hasMaterial dyn:hasWaveSpeed "bar_wave_speed")
        dyn:hasStrikerVelocity
    ) ;
    gui:priority 8 .

gui:shpb_calc_005 a gui:Constraint ;
    rdfs:label "Pulse Stress Amplitude Calculation" ;
    rdfs:comment "Compute stress amplitude = rho*C*V/2 from striker velocity, bar wave speed and density." ;
    dc:created "2025-02-12"^^xsd:date ;
    gui:forClass dyn:SHPBCompression ;
    gui:triggers dyn:hasStrikerVelocity ;
    gui:whenValue gui:anyValue ;
    gui:calculationFunction "pulse_stress_amplitude" ;
    gui:calculationTarget dyn:hasPulseStressAmplitude ;
    gui:calculationInputs (
        (dyn:hasIncidentBar dyn:hasMaterial dyn:hasWaveSpeed "bar_wave_speed")
        (dyn:hasIncidentBar dyn:hasMaterial dyn:hasDensity "bar_density")
        dyn:hasStrikerVelocity
    ) ;
    gui:priority 8 .


#================================================================
# 5.0 Export Page – Validity Override Visibility
# When the analyst enables the validity override, reveal the
# manual validity selector and override reason fields.
# These fields are hidden by default and auto-populated from
# equilibrium metrics (FBC, SEQI, DSUF).
#================================================================

gui:export_c001 a gui:Constraint ;
    rdfs:label "Show validity override fields when override is enabled" ;
    rdfs:comment "Reveals hasTestValidity and hasValidityOverrideReason when dyn:isValidityOverridden is true. Fields are hidden by default and populated by auto-assessment; only shown when analyst explicitly overrides." ;
    dc:created "2026-02-17"^^xsd:date ;
    gui:forClass dyn:SHPBCompression ;
    gui:triggers dyn:isValidityOverridden ;
    gui:triggerLogic gui:ALL ;
    gui:whenValue "true"^^xsd:boolean ;
    gui:showFields (dyn:hasTestValidity dyn:hasValidityOverrideReason) ;
    gui:priority 5 .


